set(EXE_SERVER "redis-server")
set(EXE_CLI "redis-cli")

execute_process(COMMAND sh -x ${CMAKE_CURRENT_SOURCE_DIR}/mkreleasehdr.sh
    WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR})

set(REDIS_RELEASE_HFILE release.h)
set(REDIS_HFILES
    adlist.h
    ae.h
    anet.h
    asciilogo.h
    atomicvar.h
    bio.h
    cluster.h
    config.h
    crc64.h
    debugmacro.h
    dict.h
    endianconv.h
    fmacros.h
    geo.h
    geohash.h
    geohash_helper.h
    help.h
    intset.h
    latency.h
    lzf.h
    lzfP.h
    pqsort.h
    quicklist.h
    rand.h
    rax.h
    rax_malloc.h
    rdb.h
    redisassert.h
    redismodule.h
    release.h
    rio.h
    sds.h
    sdsalloc.h
    server.h
    sha1.h
    slowlog.h
    solarisfixes.h
    sparkline.h
    testhelp.h
    util.h
    version.h
    ziplist.h
    zipmap.h
    zmalloc.h)

set(REDIS_CFILES
    adlist.c
    ae.c
    anet.c
    aof.c
    bio.c
    bitops.c
    blocked.c
    childinfo.c
    cluster.c
    config.c
    crc16.c
    crc64.c
    db.c
    debug.c
    defrag.c
    dict.c
    endianconv.c
    evict.c
    expire.c
    geo.c
    geohash.c
    geohash_helper.c
    hyperloglog.c
    intset.c
    latency.c
    lazyfree.c
    lzf_c.c
    lzf_d.c
    memtest.c
    module.c
    multi.c
    networking.c
    notify.c
    object.c
    pqsort.c
    pubsub.c
    quicklist.c
    rand.c
    rax.c
    rdb.c
#    redis-benchmark.c
    redis-check-aof.c
    redis-check-rdb.c
#    redis-cli.c
    release.c
    replication.c
    rio.c
    scripting.c
    sds.c
    sentinel.c
    server.c
    setproctitle.c
    sha1.c
    siphash.c
    slowlog.c
    sort.c
    sparkline.c
    syncio.c
    t_hash.c
    t_list.c
    t_set.c
    t_string.c
    t_zset.c
    util.c
    ziplist.c
    zipmap.c
    zmalloc.c)

SET(REDIS_FILES ${REDIS_CFILES} ${REDIS_RELEASE_FILE} ${REDIS_HFILES})

add_executable(
    ${EXE_SERVER}
    ${REDIS_FILES}
)

target_include_directories(
    ${EXE_SERVER} PUBLIC
    ${REDIS_SOURCE_DIR}/deps/hiredis
    ${REDIS_SOURCE_DIR}/deps/lua/src
    ${REDIS_SOURCE_DIR}/deps/geohash-int
    ${REDIS_SOURCE_DIR}/deps/linenoise)
target_link_libraries( ${EXE_SERVER} m dl pthread liblua libhiredis liblinenoise)

set_target_properties(${EXE_SERVER} PROPERTIES
    DEBUG_POSTFIX "${CMAKE_DEBUG_POSTFIX}")

set(REDIS_CLI_HFILES
    anet.h
    adlist.h
    zmalloc.h
    ae.h
    crc64.h)

set(REDIS_CLI_CFILES
    anet.c
    adlist.c
    redis-cli.c
    zmalloc.c
    ae.c
    crc64.c
    release.c)

add_executable(${EXE_CLI}
    ${REDIS_CLI_HFILES} ${REDIS_CLI_CFILES} ${REDIS_RELEASE_HFILE})

target_include_directories(
    ${EXE_CLI} BEFORE PUBLIC
    ${REDIS_SOURCE_DIR}/deps/hiredis
    ${REDIS_SOURCE_DIR}/deps/linenoise)
target_link_libraries( ${EXE_CLI} libhiredis liblinenoise)

set_target_properties(${EXE_CLI} PROPERTIES
    DEBUG_POSTFIX "${CMAKE_DEBUG_POSTFIX}")

install(TARGETS ${EXE_SERVER} DESTINATION bin)
install(TARGETS ${EXE_CLI} DESTINATION bin)
